<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TAOBUN Management Suite</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="TAOBUN">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
  @font-face {
    font-family: 'Denton Variable';
    src: local('Denton Variable'), local('Denton-Variable');
    font-weight: 100 900;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --primary: #d61e30; 
    --bg: #ffffff;
    --border: #eeeeee;
    --text: #1a1a1a;
    --muted: #777777;
    --card-bg: #f9f9f9;
    --pill-bg: #fff0f1;
    --transition-smooth: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  [data-theme="dark"] {
    --bg: #0a0a0f;
    --border: #2a2a3e;
    --text: #e8e8f0;
    --muted: #6b6b8a;
    --card-bg: #14141d;
    --pill-bg: rgba(214, 30, 48, 0.15);
  }

  body {
    font-family: 'Denton Variable', serif;
    background: var(--bg);
    color: var(--text);
    padding: 40px 20px;
    transition: background 0.4s ease, color 0.4s ease;
    -webkit-font-smoothing: antialiased;
  }

  .container { max-width: 550px; margin: 0 auto; }
  
  /* Navigation & Views */
  .view-container { 
    display: none; 
    opacity: 0;
    transform: scale(0.98) translateY(10px);
    transition: var(--transition-smooth);
  }
  
  .view-active { 
    display: block; 
    animation: fadeScale 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes fadeScale {
    from { opacity: 0; transform: scale(0.98) translateY(15px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }

  header { 
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 40px;
    position: relative;
  }

  .theme-toggle {
    position: absolute; right: 0; top: 0;
    background: none; border: none; cursor: pointer;
    width: 40px; height: 40px; color: var(--text);
    transition: transform 0.3s ease, color 0.3s ease;
  }

  .theme-toggle:hover {
    transform: rotate(15deg) scale(1.1);
  }

  .theme-toggle svg { width: 22px; height: 22px; fill: none; stroke: currentColor; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }
  .sun { display: block; }
  .moon { display: none; }
  [data-theme="dark"] .sun { display: none; }
  [data-theme="dark"] .moon { display: block; }

  .badge { display: inline-block; font-size: 11px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--primary); border: 1px solid var(--primary); padding: 6px 16px; border-radius: 4px; margin-bottom: 20px; font-weight: 700; transition: var(--transition-smooth); }
  h1 { font-size: 32px; font-weight: 800; line-height: 1.1; text-align: center; }
  h1 span { color: var(--primary); }

  /* Home Menu Style */
  .menu-grid { display: grid; grid-template-columns: 1fr; gap: 16px; margin-top: 30px; }
  .menu-card { 
    background: var(--card-bg); 
    border: 1px solid var(--border); 
    padding: 24px; 
    border-radius: 16px; 
    cursor: pointer; 
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    gap: 20px;
  }
  .menu-card:hover { 
    border-color: var(--primary); 
    transform: translateY(-4px); 
    box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
  }
  [data-theme="dark"] .menu-card:hover { box-shadow: 0 10px 25px -5px rgba(0,0,0,0.4); }
  
  .menu-card.disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); transform: none; box-shadow: none; hover: border-color: var(--border); }
  .menu-card.disabled:hover { border-color: var(--border); }
  
  .menu-icon { 
    color: var(--primary);
    background: var(--pill-bg); 
    padding: 12px; 
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-smooth);
  }
  .menu-icon svg { width: 24px; height: 24px; stroke-width: 1.5; stroke: currentColor; fill: none; stroke-linecap: round; stroke-linejoin: round; }
  
  .menu-card:hover .menu-icon { transform: scale(1.05); }

  .menu-info h3 { font-size: 18px; font-weight: 800; margin: 0; }

  .back-btn {
    background: none; border: none; color: var(--muted); font-family: inherit;
    font-size: 13px; font-weight: 700; cursor: pointer; margin-bottom: 20px;
    display: flex; align-items: center; gap: 6px;
    transition: color 0.3s ease, transform 0.3s ease;
  }
  .back-btn:hover { color: var(--text); transform: translateX(-3px); }

  /* Dashboard Styles */
  .revenue-section { text-align: center; margin-bottom: 40px; }
  .revenue-label { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 8px; transition: color 0.3s ease; }
  .revenue-value { font-size: 42px; font-weight: 800; color: var(--primary); transition: transform 0.3s ease; }
  
  .section-group { background: var(--card-bg); border-radius: 16px; padding: 24px; margin-bottom: 30px; border: 1px solid var(--border); transition: var(--transition-smooth); }
  .section-group:hover { border-color: rgba(214, 30, 48, 0.3); }
  
  .section-label { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: var(--text); margin-bottom: 20px; border-bottom: 3px solid var(--primary); font-weight: 900; padding-bottom: 6px; display: inline-block; transition: color 0.3s ease; }
  .date-row { display: flex; justify-content: center; gap: 12px; margin-bottom: 35px; padding: 10px; }
  
  select { 
    font-family: inherit; font-size: 13px; font-weight: 700; 
    background-color: var(--card-bg); color: var(--text); 
    border: 1px solid var(--border); border-radius: 6px; 
    padding: 8px 14px; outline: none; cursor: pointer;
    transition: var(--transition-smooth);
  }
  select:hover, select:focus { border-color: var(--primary); }
  
  .deck-item { display: flex; justify-content: space-between; align-items: flex-end; padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.03); transition: border-color 0.3s ease; }
  [data-theme="dark"] .deck-item { border-bottom: 1px solid rgba(255,255,255,0.03); }
  
  .deck-title { font-weight: 700; font-size: 14px; display: flex; align-items: center; gap: 8px; color: var(--text); transition: color 0.3s ease;}
  .target-pill { font-size: 10px; font-weight: 800; color: var(--primary); background: var(--pill-bg); padding: 2px 6px; border-radius: 4px; display: none; }
  
  .input-field { display: flex; align-items: baseline; gap: 6px; border-bottom: 2px solid var(--border); padding-bottom: 4px; transition: border-color 0.3s ease; }
  .input-field:focus-within { border-bottom-color: var(--primary); }
  
  input { font-family: inherit; border: none; background: none; font-size: 18px; font-weight: 800; width: 110px; text-align: right; color: var(--text); outline: none; transition: color 0.3s ease; }
  .unit { font-size: 12px; font-weight: 700; color: var(--muted); transition: color 0.3s ease; }
  .auto-result { font-size: 18px; font-weight: 800; color: var(--primary); }
  
  .export-btn { 
    width: 100%; background: var(--primary); color: white; border: none; 
    padding: 18px; font-family: 'Denton Variable', serif; font-weight: 800; 
    font-size: 14px; text-transform: uppercase; letter-spacing: 1px; 
    border-radius: 12px; cursor: pointer; margin-top: 10px; margin-bottom: 50px;
    transition: var(--transition-smooth);
    position: relative;
    overflow: hidden;
  }
  .export-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 15px rgba(214, 30, 48, 0.25); }
  .export-btn:active { transform: translateY(0); }

  .charts-grid { display: flex; flex-direction: column; gap: 50px; border-top: 1px solid var(--border); padding-top: 40px; padding-bottom: 60px; transition: border-color 0.3s ease;}
  .chart-header { font-size: 12px; text-transform: uppercase; color: var(--text); text-align: center; font-weight: 800; margin-bottom: 25px; transition: color 0.3s ease;}
  .chart-container { height: 250px; position: relative; }

  @media (max-width: 768px) { h1 { font-size: 28px; } .revenue-value { font-size: 36px; } }
</style>
</head>
<body data-theme="light">

<div class="container">
  
  <div id="home-view" class="view-container view-active">
    <header>
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Theme">
        <svg class="sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        <svg class="moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      </button>
      <div class="badge">CV. Roti Semua Generasi</div>
      <h1>WELCOME TO<br><span>TAOBUN</span> MANAGEMENT</h1>
    </header>

    <div class="menu-grid">
      <div class="menu-card" onclick="showView('revenue-view')">
        <div class="menu-icon">
          <svg viewBox="0 0 24 24">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
          </svg>
        </div>
        <div class="menu-info">
          <h3>Revenue Dashboard</h3>
        </div>
      </div>

      <div class="menu-card disabled">
        <div class="menu-icon">
          <svg viewBox="0 0 24 24">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
            <line x1="12" y1="22.08" x2="12" y2="12"></line>
          </svg>
        </div>
        <div class="menu-info">
          <h3>Coming Soon!</h3>
        </div>
      </div>
    </div>
  </div>

  <div id="revenue-view" class="view-container">
    <button class="back-btn" onclick="showView('home-view')">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
      Back to Menu
    </button>
    <header>
      <h1><span>TAOBUN</span><br>REVENUE</h1>
    </header>

    <div class="revenue-section">
      <p class="revenue-label">Total Revenue</p>
      <div class="revenue-value" id="totalRevenue">Rp 0</div>
    </div>

    <p class="section-label" style="text-align: center; border-bottom: none; width: 100%; margin-top: 0;">Report Period</p>
    <div class="date-row">
      <select id="repMonth" onchange="calculate()">
        <option value="01">Januari</option><option value="02" selected>Februari</option>
        <option value="03">Maret</option><option value="04">April</option>
        <option value="05">Mei</option><option value="06">Juni</option>
        <option value="07">Juli</option><option value="08">Agustus</option>
        <option value="09">September</option><option value="10">Oktober</option>
        <option value="11">November</option><option value="12">Desember</option>
      </select>
      <select id="repYear" onchange="calculate()"></select>
    </div>

    <div class="deck-list">
      <div class="section-group">
        <p class="section-label">Market</p>
        <div class="deck-item">
          <div class="deck-info"><p class="deck-title">Leads <span id="targetLeads" class="target-pill"></span></p></div>
          <div class="input-field"><input type="text" id="leads" value="0" inputmode="decimal" oninput="handleInput(this)" onfocus="this.select()"></div>
        </div>
        <div class="deck-item">
          <div class="deck-info"><p class="deck-title">Conv. Target <span id="targetConvRate" class="target-pill"></span></p></div>
          <div class="input-field"><input type="text" id="convTargetInput" value="0" inputmode="decimal" oninput="handleInput(this)" onfocus="this.select()"><span class="unit">%</span></div>
        </div>
        <div class="deck-item" style="opacity: 0.8;">
          <div class="deck-info"><p class="deck-title">Lead Conv. Rate <span id="leadStatusPill" class="target-pill"></span></p></div>
          <div class="auto-result" id="leadConvDisplay">0%</div>
        </div>
      </div>

      <div class="section-group">
        <p class="section-label">Value</p>
        <div class="deck-item">
          <div class="deck-info"><p class="deck-title">Basket Size <span id="targetBasket" class="target-pill"></span></p></div>
          <div class="input-field"><span class="unit">Rp</span><input type="text" id="basketSize" value="0" inputmode="decimal" oninput="handleInput(this)" onfocus="this.select()"></div>
        </div>
        <div class="deck-item">
          <div class="deck-info"><p class="deck-title">Avg Tx <span id="targetTx" class="target-pill"></span></p></div>
          <div class="input-field"><input type="text" id="avgTx" value="0" inputmode="decimal" oninput="handleInput(this)" onfocus="this.select()"><span class="unit">x</span></div>
        </div>
        <input type="hidden" id="totalCustInput" value="100"> 
        <input type="hidden" id="retentionCust" value="0">
      </div>

      <div class="section-group">
        <p class="section-label">Simulation</p>
        <div class="deck-item">
          <div class="deck-info"><p class="deck-title">Growth Target</p></div>
          <div class="input-field"><input type="text" id="optPercent" value="0" inputmode="decimal" oninput="handleInput(this)" onfocus="this.select()" style="color: var(--primary);"><span class="unit" style="color: var(--primary);">%</span></div>
        </div>
        <div class="deck-item" style="border-top: 1px dashed var(--border); margin-top: 10px; padding-top: 15px;">
          <div class="deck-info"><p class="deck-title" style="color: var(--primary);">Projected Revenue</p></div>
          <div class="auto-result" id="projectedRevenueDisplay">Rp 0</div>
        </div>
      </div>
    </div>

    <button class="export-btn" onclick="exportToExcel()">Export Report to Excel</button>

    <div class="charts-grid">
      <div class="chart-box"><p class="chart-header">Conversion Funnel (%)</p><div class="chart-container"><canvas id="funnelChart"></canvas></div></div>
      <div class="chart-box"><p class="chart-header">Revenue Growth Strategy (%)</p><div class="chart-container"><canvas id="growthChart"></canvas></div></div>
    </div>
  </div>

</div>

<script>
Chart.register(ChartDataLabels);
let funnelChart, growthChart;

// NAVIGATION LOGIC
function showView(viewId) {
  document.querySelectorAll('.view-container').forEach(v => {
    v.classList.remove('view-active');
  });
  
  const targetView = document.getElementById(viewId);
  targetView.classList.add('view-active');
  
  if(viewId === 'revenue-view') {
    setTimeout(() => {
      if(funnelChart) funnelChart.update();
      if(growthChart) growthChart.update();
    }, 150);
  }
}

function toggleTheme() {
  const newTheme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
  document.body.setAttribute('data-theme', newTheme);
  updateChartsTheme(newTheme);
}

function populateDates() {
  const yearSel = document.getElementById('repYear');
  if(!yearSel) return;
  const startYear = 2026;
  for(let i=startYear; i<=startYear+5; i++) {
    let opt = document.createElement('option');
    opt.value = i; opt.textContent = i;
    yearSel.appendChild(opt);
  }
}

function updateChartsTheme(theme) {
  const color = theme === 'dark' ? '#e8e8f0' : '#1a1a1a';
  [funnelChart, growthChart].forEach(chart => {
    if(chart) {
      chart.options.plugins.datalabels.color = color;
      if(chart.options.scales.y) chart.options.scales.y.ticks.color = color;
      if(chart.options.scales.x) chart.options.scales.x.ticks.color = color;
      chart.update();
    }
  });
}

function initCharts() {
  const color = document.body.getAttribute('data-theme') === 'dark' ? '#e8e8f0' : '#1a1a1a';
  const font = { family: 'Denton Variable', size: 10, weight: '800' };

  funnelChart = new Chart(document.getElementById('funnelChart'), {
    type: 'bar',
    data: { labels: ['Leads', 'Customers', 'Transactions'], datasets: [{ data: [0,0,0], backgroundColor: ['#f4f4f4', '#d61e30', '#1a1a1a'], borderRadius: 4, barThickness: 25 }] },
    options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: {display: false}, datalabels: { color, font } }, scales: { x: {display: false}, y: {ticks: {color, font: {family: 'Denton Variable'}}, grid: {display: false}} }, animation: { duration: 800, easing: 'easeOutQuart' } }
  });

  growthChart = new Chart(document.getElementById('growthChart'), {
    type: 'bar',
    data: { labels: ['Current', 'Target'], datasets: [{ data: [0,0], backgroundColor: ['#1a1a1a', '#d61e30'], borderRadius: 6, barThickness: 50 }] },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display: false}, datalabels: { color, font } }, scales: { y: {display: false}, x: {ticks: {color, font: {family: 'Denton Variable'}}, grid: {display: false}} }, animation: { duration: 800, easing: 'easeOutQuart' } }
  });
}

function formatNumber(val) {
  let clean = val.toString().replace(/[^0-9,]/g, "");
  let parts = clean.split(",");
  let int = parts[0].replace(/^0+/, "") || "0";
  return int.replace(/\B(?=(\d{3})+(?!\d))/g, ".") + (parts.length > 1 ? "," + parts[1] : "");
}

function cleanNumber(val) { return parseFloat(val.toString().replace(/\./g, "").replace(",", ".")) || 0; }

function handleInput(el) {
  let cursor = el.selectionStart;
  let oldLen = el.value.length;
  el.value = formatNumber(el.value);
  el.setSelectionRange(cursor + (el.value.length - oldLen), cursor + (el.value.length - oldLen));
  calculate();
}

function fmtCurrency(n) {
  return 'Rp ' + n.toLocaleString('id-ID', { maximumFractionDigits: 0 });
}

function calculate() {
  const leads = cleanNumber(document.getElementById('leads').value);
  const convTarget = cleanNumber(document.getElementById('convTargetInput').value);
  const basket = cleanNumber(document.getElementById('basketSize').value);
  const avgTx = cleanNumber(document.getElementById('avgTx').value);
  const opt = cleanNumber(document.getElementById('optPercent').value);

  const factor = 1 + (opt/100);
  const totalCust = leads * (convTarget/100) || 0;
  const currentRev = totalCust * avgTx * basket;
  const optRev = currentRev * Math.pow(factor, 3);

  document.getElementById('totalRevenue').textContent = fmtCurrency(currentRev);
  document.getElementById('projectedRevenueDisplay').textContent = fmtCurrency(optRev);

  if(funnelChart) { funnelChart.data.datasets[0].data = [leads, totalCust, totalCust * avgTx]; funnelChart.update(); }
  if(growthChart) { growthChart.data.datasets[0].data = [currentRev, optRev]; growthChart.update(); }
}

window.onload = () => { populateDates(); initCharts(); calculate(); };
</script>
</body>
</html>
